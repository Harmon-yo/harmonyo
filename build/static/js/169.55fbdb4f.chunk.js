"use strict";(self.webpackChunkharmonyo=self.webpackChunkharmonyo||[]).push([[169],{3345:function(e,a,t){var n=t(9439),s=t(3044),o=t(2791),i=t(1659),r=t(184);function l(e,a){var t=e.id,l=e.nome,c=(0,o.useState)(""),d=(0,n.Z)(c,2),u=d[0],m=d[1],h=(0,o.useState)(!1),f=(0,n.Z)(h,2),g=f[0],x=f[1];(0,o.useImperativeHandle)(a,(function(){return{getImgPerfilURL:function(){return u}}}),[u]);var p=function(e){var a="/imgs-perfil-usuario/".concat(e,"_ft_perfil");i.t.ref(a).getDownloadURL().then((function(e){m(e)})).catch((function(){x(!0)}))};(0,o.useEffect)((function(){e.naoCarregar&&(e.imgUrl?m(e.imgUrl):p(t))}),[]),(0,o.useEffect)((function(){e.imgUrl?(m(e.imgUrl),x(!1)):p(t)}),[e.recarregarImg]);var v=g?"#099250":"#eeeeee",j=e.sx?e.sx:{};return j.bgcolor=v,g?(0,r.jsx)(s.Z,{className:e.className,onClick:e.onClick,"aria-controls":e.ariaControls,"aria-haspopup":e.ariaHaspopup,"aria-expanded":e.ariaExpanded,sx:j,children:g?l.charAt(0):""}):(0,r.jsx)(s.Z,{src:g?null:u,className:e.className,onClick:e.onClick,"aria-controls":e.ariaControls,"aria-haspopup":e.ariaHaspopup,"aria-expanded":e.ariaExpanded,sx:j,children:g?l.charAt(0):""})}a.Z=(0,o.forwardRef)(l)},169:function(e,a,t){t.r(a),t.d(a,{default:function(){return J}});var n=t(9439),s=t(2791),o=t(1659),i=t(4554),r=t(3239),l=t(1978),c=t(8096),d=t(4925),u=t(8406),m=t(3786),h=t(3006),f=t(1889),g=t(493),x=t(4852),p=t(7064),v=t(9900),j=t(4721),Z=t(1478);function b(e){if(null==e)return"00/00/0000";var a=new l.EK(e.seconds,e.nanoseconds).toDate();return(a.getDate()<10?"0"+a.getDate():a.getDate())+"/"+(a.getMonth()<10?"0"+a.getMonth():a.getMonth())+"/"+a.getFullYear()}function C(e){var a=new Date(e);return(a.getDate()<10?"0"+a.getDate():a.getDate())+"/"+(a.getMonth()<10?"0"+a.getMonth():a.getMonth())+"/"+a.getFullYear()}var S=t(5574),y=t(5661),N=t(9157),D=t(1691),w=t(7123),I=t(6151),A=t(3345),P=t(184);function E(e){var a=s.useState(e.abreModal),t=(0,n.Z)(a,2),i=t[0],r=t[1],b=s.useState(""),C=(0,n.Z)(b,2),E=C[0],k=C[1],M=s.useState(""),_=(0,n.Z)(M,2),F=_[0],q=_[1],O=s.useState(!1),R=(0,n.Z)(O,2),U=R[0],B=R[1],H=s.useState(!1),W=(0,n.Z)(H,2),T=W[0],K=W[1],G=function(){r(!1),k(""),q(""),B(!1)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(S.Z,{open:i,onClose:G,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,P.jsxs)(y.Z,{id:"alert-dialog-title",children:["Gostaria de denunciar ",e.nome,"?"]}),(0,P.jsxs)(N.Z,{children:[(0,P.jsx)(D.Z,{id:"alert-dialog-description",children:"Qual o motivo da den\xfancia?"}),(0,P.jsxs)(c.Z,{fullWidth:!0,children:[(0,P.jsx)(d.Z,{id:"demo-simple-select-label",children:"Motivo da den\xfancia"}),(0,P.jsxs)(u.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:E,label:"Motivo da den\xfancia",onChange:function(e){3===e.target.value&&B(!0),null!==e.target.value&&K(!1),k(e.target.value)},error:T,children:[(0,P.jsx)(m.Z,{value:"Bullying e ass\xe9dio",children:"Bullying e ass\xe9dio"}),(0,P.jsx)(m.Z,{value:"Palavras ofensivas",children:"Palavras ofensivas"}),(0,P.jsx)(m.Z,{value:"Informa\xe7\xf5es incorretas prejudiciais",children:"Informa\xe7\xf5es incorretas prejudiciais"}),(0,P.jsx)(m.Z,{value:3,children:"Outro"})]}),U?(0,P.jsx)(h.Z,{id:"outlined-basic",label:"Outro motivo",variant:"outlined",value:F,error:T,helperText:T?"Digite o motivo da den\xfancia":"",onChange:function(e){return q(e.target.value)}}):(0,P.jsx)(P.Fragment,{})]})]}),(0,P.jsxs)(w.Z,{children:[(0,P.jsx)(I.Z,{onClick:G,children:"N\xe3o"}),(0,P.jsx)(I.Z,{onClick:function(){if(U){if(""===F)return void K(!0);K(!1)}else if(""===E)return void K(!0);!function(e){var a=e.idConversa;delete e.idConversa;var t=(0,l.Bt)();e.timestamp=t,o.db.doc("chats/".concat(a)).collection("denuncia").add(e).then((function(){o.db.doc("chats/".concat(a)).update({bloqueado:!0,timestamp:t,ultimaMensagem:"Chat bloqueado!"}).then((function(){alert("Denuncia salva!"),window.location.reload()}))})).catch((function(e){console.log(e)}))}({motivo:F||E,idDenunciante:Number(sessionStorage.ID),idDenunciado:e.idUsuarioConversa,idConversa:e.idConversa}),G()},autoFocus:!0,children:"Sim, denunciar"})]})]}),(0,P.jsxs)(f.ZP,{item:!0,xs:3,style:{borderRight:"500"},children:[(0,P.jsxs)(g.Z,{className:"chat_header",children:[(0,P.jsxs)(x.ZP,{children:[(0,P.jsx)(p.Z,{children:(0,P.jsx)(A.Z,{id:e.idUsuarioConversa,nome:e.nome,className:"avatar"})}),(0,P.jsx)(v.Z,{primary:e.nome})]},e.nome),(0,P.jsx)(x.ZP,{style:{width:"min-content",marginRight:"10px"},button:!0,onClick:function(){return r(!0)},children:(0,P.jsx)(Z.Z,{style:{fontSize:"40px"}})},0)]}),(0,P.jsx)(j.Z,{})]})]})}var k=t(886),M=t(9877),_=t(1686);function F(e){return(0,P.jsxs)(f.ZP,{container:!0,style:{padding:"20px"},children:[(0,P.jsx)(f.ZP,{item:!0,xs:11,children:(0,P.jsx)(k.ZP,{sx:{ml:1,flex:1},placeholder:"Insira aqui a sua mensagem",fullWidth:!0,autoFocus:!0,multiline:!0,rows:2,onKeyDown:function(a){"Enter"===a.key&&(a.preventDefault(),e.onClick())},onChangeCapture:function(a){return e.onChange(a.target.value)},value:e.value,style:{border:"1px solid #ccc",borderRadius:"5px",padding:"10px"}})}),(0,P.jsx)(f.ZP,{xs:1,align:"right",onClick:function(){return e.onClick()},children:(0,P.jsx)(M.Z,{color:"rgba(29, 185, 84, 0.25)","aria-label":"add",children:(0,P.jsx)(_.Z,{})})})]})}var q=t(3433);function O(e){var a,t="left";e.idEnviou===Number(sessionStorage.getItem("ID"))&&(t="right"),null!==e.timestamp?a=new l.EK(e.timestamp.seconds,e.timestamp.nanoseconds).toDate():(console.log(e),a=new Date);var n=(a.getHours()<10?"0"+a.getHours():a.getHours())+":"+(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes());return"left"===t?(0,P.jsx)(x.ZP,{style:{maxWidth:"50%"},children:(0,P.jsxs)(f.ZP,{container:!0,children:[(0,P.jsx)(f.ZP,{item:!0,xs:12,style:{maxWidth:"fit-content"},className:"esquerda_mensagem",children:(0,P.jsx)(v.Z,{align:"left",primary:e.texto,style:{wordWrap:"break-word",width:"fit-content"}})}),(0,P.jsx)(f.ZP,{item:!0,xs:12,children:(0,P.jsx)(v.Z,{align:"left",secondary:n})})]})},e.key):(0,P.jsx)(x.ZP,{style:{maxWidth:"50%",alignSelf:"flex-end"},children:(0,P.jsxs)(f.ZP,{container:!0,style:{justifyContent:"flex-end"},children:[(0,P.jsx)(f.ZP,{item:!0,xs:12,style:{maxWidth:"fit-content"},className:"direita_mensagem",children:(0,P.jsx)(v.Z,{align:"left",primary:e.texto,style:{wordWrap:"break-word",width:"fit-content"}})}),(0,P.jsx)(f.ZP,{item:!0,xs:12,children:(0,P.jsx)(v.Z,{align:"right",secondary:n})})]})},e.key)}function R(e){return"00/00/0000"===e.data?(0,P.jsx)(P.Fragment,{}):(0,P.jsx)(i.Z,{className:"divisor",children:(0,P.jsxs)(i.Z,{className:"data_centralizada",children:[(0,P.jsx)(i.Z,{className:"linha"}),(0,P.jsx)(i.Z,{className:"data",children:(0,P.jsx)(v.Z,{primary:e.data})}),(0,P.jsx)(i.Z,{className:"linha"})]})})}function U(e){var a=s.useState([]),t=(0,n.Z)(a,2),l=t[0],c=t[1],d=s.useState(!1),u=(0,n.Z)(d,2),m=u[0],h=u[1],f=0,g="",x=(0,s.useRef)(null);return(0,s.useEffect)((function(){h(!1);var a=o.db.doc("chats/".concat(e.id)).collection("mensagens").orderBy("timestamp","asc").onSnapshot((function(e){c([]),e.docs.map((function(e){c((function(a){return[].concat((0,q.Z)(a),[{id:e.id,idEnviou:e.data().idEnviou,texto:e.data().texto,timestamp:e.data().timestamp,lida:e.data().lida}])}))})),h(!0)}));return function(){return a()}}),[e.id]),(0,s.useEffect)((function(){x.current&&(x.current.scrollTop=x.current.scrollHeight)}),[l]),m?(0,P.jsx)(i.Z,{ref:x,className:"messageBoxContainer",children:l.map((function(a){if(a.lida||o.db.doc("chats/".concat(e.id)).collection("mensagens").doc(a.id).update({lida:!0}),1===++f||g!==b(a.timestamp)){g=b(a.timestamp);var t="";return t=b(a.timestamp)===C(new Date)?"Hoje":b(a.timestamp)===C(new Date((new Date).setDate((new Date).getDate()-1)))?"Ontem":b(a.timestamp),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(R,{data:t}),(0,P.jsx)(O,{id:a.id,idEnviou:a.idEnviou,texto:a.texto,timestamp:a.timestamp},a.id)]})}return(0,P.jsx)(O,{id:a.id,idEnviou:a.idEnviou,texto:a.texto,timestamp:a.timestamp,onLoad:function(){return console.log("aaa")}},a.id)}))}):(0,P.jsx)(i.Z,{style:{display:"flex",justifyContent:"center"},children:(0,P.jsx)(r.Z,{style:{color:"#6DDB94"}})})}var B=function(e){return(0,P.jsx)(i.Z,{className:"background-bloqueado",children:(0,P.jsxs)(i.Z,{className:"texto-bloqueado",children:["Sua conversa com ",e.nome," est\xe1 bloqueada por motivo de den\xfancia. Por favor, caso voc\xea entenda que algo est\xe1 errado, entre em contato com o nosso suporte."]})})};function H(e){return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(E,{idUsuarioConversa:e.idUsuarioConversa,nome:e.nome,idConversa:e.id}),(0,P.jsx)(U,{id:e.id}),e.isBloqueado?(0,P.jsx)(B,{nome:e.nome}):(0,P.jsx)(F,{value:e.valueInput,onChange:e.onChange,onClick:function(){e.onClick(),""!==e.valueInput&&function(e,a){var t=Number(sessionStorage.getItem("ID")),n=e,s=(0,l.Bt)(),i={idEnviou:t,timestamp:s,texto:e,lida:!1};o.db.doc("chats/".concat(a)).collection("mensagens").add(i).then((function(){var e=document.getElementById("scroll");e.scrollTop=e.scrollHeight})),o.db.collection("chats").doc(a).update({ultimaMensagem:n,timestamp:s})}(e.valueInput,e.id)}})]})}var W=t(7394),T=t(890),K=t(7689);function G(){var e=(0,K.s0)();return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(x.ZP,{className:"chat_profile",children:[(0,P.jsx)(x.ZP,{button:!0,className:"voltar",style:{display:"flex",justifyContent:"left",width:"fit-content",height:"fit-content"},onClick:function(){return e(-1)},children:(0,P.jsx)(W.Z,{style:{width:"35px",height:"35px",padding:"5px",borderRadius:"100%",background:"#363636"}})}),(0,P.jsx)(p.Z,{children:(0,P.jsx)(A.Z,{id:Number(sessionStorage.ID),nome:sessionStorage.NOME,className:"avatar"})}),(0,P.jsx)(T.Z,{variant:"h6",component:"div",children:sessionStorage.NOME})]})})}var z=t(653);function Y(e){var a,t,r=s.useState(e.lida),c=(0,n.Z)(r,2),d=(c[0],c[1]),u=s.useState(10),m=(0,n.Z)(u,2),h=m[0],f=m[1],g=s.useState(!1),p=(0,n.Z)(g,2),Z=(p[0],p[1]);(0,s.useEffect)((function(){Z(!1);var a=o.db.collection("chats").doc(e.id).collection("mensagens").where("idEnviou","!=",Number(sessionStorage.getItem("ID"))).where("lida","==",!1).onSnapshot((function(e){f(e.docs.length),Z(!0)}));return function(){return a()}}),[h]);var S=new l.EK(null===(a=e.timestamp)||void 0===a?void 0:a.seconds,null===(t=e.timestamp)||void 0===t?void 0:t.nanoseconds).toDate(),y=new Date,N=S.getDate()===y.getDate()&&S.getMonth()===y.getMonth()&&S.getFullYear()===y.getFullYear(),D=b(e.timestamp),w=function(e){if(null==e)return"00/00/0000";var a=new l.EK(e.seconds,e.nanoseconds).toDate();return(a.getHours()<10?"0"+a.getHours():a.getHours())+":"+(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())}(e.timestamp);return b(e.timestamp)===C(new Date((new Date).setDate((new Date).getDate()-1)))&&(D="Ontem"),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(x.ZP,{button:!0,onClick:function(){var a;e.onClick(),d(!0),a=e.id,o.db.doc("chats/".concat(a)).collection("mensagens").where("idEnviou","!=",Number(sessionStorage.getItem("ID"))).where("lida","==",!1).get().then((function(e){e.forEach((function(e){e.ref.update({lida:!0})}))}))},className:"chat_item",children:[(0,P.jsx)(z.Z,{children:(0,P.jsx)(A.Z,{id:e.idContato,nome:e.nome,className:"avatar"})}),(0,P.jsx)(v.Z,{primary:e.nome,secondary:(0,P.jsx)(i.Z,{className:"ultima_mensagem",children:e.ultimaMensagem}),style:{width:"40%"}}),(0,P.jsx)(v.Z,{className:"data_box",children:(0,P.jsxs)(i.Z,{className:"data_notificacao",children:[(0,P.jsx)(i.Z,{className:"tempo",children:N?w:D}),0!==h?(0,P.jsx)(i.Z,{className:"notificacao",children:(0,P.jsx)(i.Z,{className:"notificacao_numero",children:h})}):null]})})]}),(0,P.jsx)(j.Z,{variant:"fullWidth",className:"divider_chat"})]})}function L(e){var a=s.useState([]),t=(0,n.Z)(a,2),i=t[0],r=t[1],c=s.useState(!1),d=(0,n.Z)(c,2);d[0],d[1];return(0,s.useEffect)((function(){var e=(0,l.IO)((0,l.hJ)(o.db,"chats"),(0,l.or)((0,l.ar)("idProfessor","==",Number(sessionStorage.ID)),(0,l.ar)("idAluno","==",Number(sessionStorage.ID))),(0,l.Xo)("timestamp","desc"));(0,l.cf)(e,(function(e){r(""),r(e.docs.map((function(e){return{id:e.id,data:{idAluno:e.data().idAluno,idProfessor:e.data().idProfessor,nome:"Aluno"===sessionStorage.CATEGORIA?e.data().nomeProfessor:e.data().nomeAluno,ultimaMensagem:e.data().ultimaMensagem,lida:e.data().lida,timestamp:e.data().timestamp,bloqueado:e.data().bloqueado}}})))}))}),[]),(0,P.jsx)(P.Fragment,{children:i.map((function(a){return(0,P.jsx)(Y,{id:a.id,nome:a.data.nome,ultimaMensagem:a.data.ultimaMensagem,timestamp:a.data.timestamp,lida:a.data.lida,foto:a.data.foto,onClick:function(){e.onChatClick(a)},idContato:"Aluno"==sessionStorage.CATEGORIA?a.data.idProfessor:a.data.idAluno},a.id)}))})}var J=function(e){var a=(0,s.useState)(null),t=(0,n.Z)(a,2),c=t[0],d=t[1],u=(0,s.useState)([]),m=(0,n.Z)(u,2),h=(m[0],m[1]),f=(0,s.useState)(""),g=(0,n.Z)(f,2),x=g[0],p=g[1],v=(0,s.useState)(""),j=(0,n.Z)(v,2),Z=j[0],b=j[1],C=(0,s.useState)(""),S=(0,n.Z)(C,2),y=(S[0],S[1],(0,s.useState)([])),N=(0,n.Z)(y,2),D=(N[0],N[1]),w=(0,s.useState)(!1),I=(0,n.Z)(w,2),A=I[0],E=I[1],k=(0,s.useState)(!1),M=(0,n.Z)(k,2),_=M[0],F=M[1],q=(0,s.useState)(0),O=(0,n.Z)(q,2),R=O[0],U=O[1],B=(0,K.TH)(),W=B.state?B.state.idChatAtivo:null,T=B.state?B.state.chatAtivo:null;return(0,s.useEffect)((function(){var e=(0,l.IO)((0,l.hJ)(o.db,"chats"),(0,l.or)((0,l.ar)("idProfessor","==",Number(sessionStorage.idUsuario)),(0,l.ar)("idAluno","==",Number(sessionStorage.idUsuario))),(0,l.Xo)("timestamp","desc")),a=(0,l.cf)(e,(function(e){D(""),D(e.docs.map((function(e){return{id:e.id,data:{idAluno:e.data().idAluno,idProfessor:e.data().idProfessor,nome:"Aluno"===sessionStorage.CATEGORIA==="aluno"?e.data().nomeProfessor:e.data().nomeAluno,src:"Aluno"===sessionStorage.CATEGORIA==="aluno"?e.data().srcProfessor:e.data().srcAluno,ultimaMensagem:e.data().ultimaMensagem,lida:e.data().lida,timestamp:e.data().timestamp,bloqueado:e.data().bloqueado}}})))}));return F(!0),function(){return a()}}),[]),(0,s.useEffect)((function(){null!==W&&null!==T&&(d(W),"Aluno"===sessionStorage.CATEGORIA?(b(T.nomeProfessor),U(T.idProfessor)):(b(T.nomeAluno),U(T.idAluno)),h([]),E(T.bloqueado))}),[T,W]),_?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(i.Z,{className:"chat_page",children:(0,P.jsxs)(i.Z,{className:"chat_container",children:[(0,P.jsxs)(i.Z,{className:"chat_left",children:[(0,P.jsx)(G,{}),(0,P.jsx)(i.Z,{className:"chat_list_container",children:(0,P.jsx)(L,{onChatClick:function(e){"Aluno"===sessionStorage.CATEGORIA?U(e.data.idProfessor):U(e.data.idAluno),d(e.id),b(e.data.nome),h([]),E(e.data.bloqueado)}})})]}),(0,P.jsx)(i.Z,{className:"message_container",children:c?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(H,{id:c,nome:Z,isBloqueado:A,valueInput:x,idUsuarioConversa:R,onChange:function(e){return p(e)},onClick:function(){return p("")}})}):(0,P.jsxs)(i.Z,{className:"empty_chat",children:[(0,P.jsx)("p",{children:"Ol\xe1! Seja bem vindo ao chat"}),(0,P.jsx)("p",{children:"Clique em algum chat para come\xe7ar a conversar"})]})})]})})}):(0,P.jsx)(r.Z,{color:"success"})}},1659:function(e,a,t){t.d(a,{db:function(){return o},t:function(){return i}});var n=t(3897),s=(t(2806),t(5778),n.Z.initializeApp({apiKey:"AIzaSyBlrwBDwFdwkutdVO2Ilg6KUPnFFwKWD2k",authDomain:"chat-harmonyo.firebaseapp.com",projectId:"chat-harmonyo",storageBucket:"chat-harmonyo.appspot.com",messagingSenderId:"295019787606",appId:"1:295019787606:web:eb01ac75f11c05b72d92f7",measurementId:"G-2K9ZW7N0C1"})),o=s.firestore(),i=s.storage("gs://chat-harmonyo.appspot.com/")}}]);
//# sourceMappingURL=169.55fbdb4f.chunk.js.map