"use strict";(self.webpackChunkharmonyo=self.webpackChunkharmonyo||[]).push([[466],{3345:function(e,t,a){var n=a(9439),s=a(3044),o=a(2791),i=a(1659),r=a(184);function l(e,t){var a=e.id,l=e.nome,c=(0,o.useState)(""),d=(0,n.Z)(c,2),u=d[0],m=d[1],h=(0,o.useState)(!1),f=(0,n.Z)(h,2),g=(f[0],f[1]),x=(0,o.useState)(!1),p=(0,n.Z)(x,2),v=p[0],j=p[1];(0,o.useImperativeHandle)(t,(function(){return{getImgPerfilURL:function(){return u}}}),[u]);var Z=function(e){var t="/imgs-perfil-usuario/".concat(e,"_ft_perfil");i.t.ref(t).getDownloadURL().then((function(e){m(e),g(!0)})).catch((function(){j(!0)}))};(0,o.useEffect)((function(){e.naoCarregar&&(e.imgUrl?m(e.imgUrl):Z(a))}),[]),(0,o.useEffect)((function(){e.imgUrl?(m(e.imgUrl),j(!1)):Z(a)}),[e.recarregarImg]);var b=v?"#099250":"#eeeeee",C=e.sx?e.sx:{};return C.bgcolor=b,v?(0,r.jsx)(s.Z,{className:e.className,onClick:e.onClick,"aria-controls":e.ariaControls,"aria-haspopup":e.ariaHaspopup,"aria-expanded":e.ariaExpanded,sx:C,children:v?l.charAt(0):""}):(0,r.jsx)(s.Z,{src:v?null:u,className:e.className,onClick:e.onClick,"aria-controls":e.ariaControls,"aria-haspopup":e.ariaHaspopup,"aria-expanded":e.ariaExpanded,sx:C,children:v?l.charAt(0):""})}t.Z=(0,o.forwardRef)(l)},9466:function(e,t,a){a.r(t),a.d(t,{default:function(){return Y}});var n=a(9439),s=a(2791),o=a(1659),i=a(4554),r=a(3239),l=a(1978),c=a(8096),d=a(4925),u=a(9321),m=a(3786),h=a(3006),f=a(1889),g=a(493),x=a(4852),p=a(7064),v=a(9900),j=a(4721),Z=a(1478),b=a(7577),C=a(5574),S=a(5661),y=a(9157),N=a(1691),D=a(7123),w=a(6151),I=a(3345),A=a(184);function P(e){var t=s.useState(e.abreModal),a=(0,n.Z)(t,2),o=a[0],i=a[1],r=s.useState(""),l=(0,n.Z)(r,2),P=l[0],E=l[1],k=s.useState(""),M=(0,n.Z)(k,2),_=M[0],F=M[1],q=s.useState(!1),O=(0,n.Z)(q,2),R=O[0],H=O[1],U=s.useState(!1),B=(0,n.Z)(U,2),W=B[0],T=B[1],K=function(){i(!1),E(""),F(""),H(!1)};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(C.Z,{open:o,onClose:K,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,A.jsxs)(S.Z,{id:"alert-dialog-title",children:["Gostaria de denunciar ",e.nome,"?"]}),(0,A.jsxs)(y.Z,{children:[(0,A.jsx)(N.Z,{id:"alert-dialog-description",children:"Qual o motivo da den\xfancia?"}),(0,A.jsxs)(c.Z,{fullWidth:!0,children:[(0,A.jsx)(d.Z,{id:"demo-simple-select-label",children:"Motivo da den\xfancia"}),(0,A.jsxs)(u.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:P,label:"Motivo da den\xfancia",onChange:function(e){3===e.target.value&&H(!0),null!==e.target.value&&T(!1),E(e.target.value)},error:W,children:[(0,A.jsx)(m.Z,{value:"Bullying e ass\xe9dio",children:"Bullying e ass\xe9dio"}),(0,A.jsx)(m.Z,{value:"Palavras ofensivas",children:"Palavras ofensivas"}),(0,A.jsx)(m.Z,{value:"Informa\xe7\xf5es incorretas prejudiciais",children:"Informa\xe7\xf5es incorretas prejudiciais"}),(0,A.jsx)(m.Z,{value:3,children:"Outro"})]}),R?(0,A.jsx)(h.Z,{id:"outlined-basic",label:"Outro motivo",variant:"outlined",value:_,error:W,helperText:W?"Digite o motivo da den\xfancia":"",onChange:function(e){return F(e.target.value)}}):(0,A.jsx)(A.Fragment,{})]})]}),(0,A.jsxs)(D.Z,{children:[(0,A.jsx)(w.Z,{onClick:K,children:"N\xe3o"}),(0,A.jsx)(w.Z,{onClick:function(){if(R){if(""===_)return void T(!0);T(!1)}else if(""===P)return void T(!0);var t={motivo:_||P,idDenunciante:Number(sessionStorage.ID),idDenunciado:e.idUsuarioConversa,idConversa:e.idConversa};(0,b.HQ)(t),K()},autoFocus:!0,children:"Sim, denunciar"})]})]}),(0,A.jsxs)(f.ZP,{item:!0,xs:3,style:{borderRight:"500"},children:[(0,A.jsxs)(g.Z,{className:"chat_header",children:[(0,A.jsxs)(x.ZP,{children:[(0,A.jsx)(p.Z,{children:(0,A.jsx)(I.Z,{id:e.idUsuarioConversa,nome:e.nome,className:"avatar"})}),(0,A.jsx)(v.Z,{primary:e.nome})]},e.nome),(0,A.jsx)(x.ZP,{style:{width:"min-content",marginRight:"10px"},button:!0,onClick:function(){return i(!0)},children:(0,A.jsx)(Z.Z,{style:{fontSize:"40px"}})},0)]}),(0,A.jsx)(j.Z,{})]})]})}var E=a(886),k=a(9877),M=a(1686);function _(e){return(0,A.jsxs)(f.ZP,{container:!0,style:{padding:"20px"},children:[(0,A.jsx)(f.ZP,{item:!0,xs:11,children:(0,A.jsx)(E.ZP,{sx:{ml:1,flex:1},placeholder:"Insira aqui a sua mensagem",fullWidth:!0,autoFocus:!0,multiline:!0,rows:2,onKeyDown:function(t){"Enter"===t.key&&(t.preventDefault(),e.onClick())},onChangeCapture:function(t){return e.onChange(t.target.value)},value:e.value,style:{border:"1px solid #ccc",borderRadius:"5px",padding:"10px"}})}),(0,A.jsx)(f.ZP,{xs:1,align:"right",onClick:function(){return e.onClick()},children:(0,A.jsx)(k.Z,{color:"rgba(29, 185, 84, 0.25)","aria-label":"add",children:(0,A.jsx)(M.Z,{})})})]})}var F=a(3433);function q(e){var t,a="left";e.idEnviou===Number(sessionStorage.getItem("ID"))&&(a="right"),null!==e.timestamp?t=new l.EK(e.timestamp.seconds,e.timestamp.nanoseconds).toDate():(console.log(e),t=new Date);var n=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());return"left"===a?(0,A.jsx)(x.ZP,{style:{maxWidth:"50%"},children:(0,A.jsxs)(f.ZP,{container:!0,children:[(0,A.jsx)(f.ZP,{item:!0,xs:12,style:{maxWidth:"fit-content"},className:"esquerda_mensagem",children:(0,A.jsx)(v.Z,{align:"left",primary:e.texto,style:{wordWrap:"break-word",width:"fit-content"}})}),(0,A.jsx)(f.ZP,{item:!0,xs:12,children:(0,A.jsx)(v.Z,{align:"left",secondary:n})})]})},e.key):(0,A.jsx)(x.ZP,{style:{maxWidth:"50%",alignSelf:"flex-end"},children:(0,A.jsxs)(f.ZP,{container:!0,style:{justifyContent:"flex-end"},children:[(0,A.jsx)(f.ZP,{item:!0,xs:12,style:{maxWidth:"fit-content"},className:"direita_mensagem",children:(0,A.jsx)(v.Z,{align:"left",primary:e.texto,style:{wordWrap:"break-word",width:"fit-content"}})}),(0,A.jsx)(f.ZP,{item:!0,xs:12,children:(0,A.jsx)(v.Z,{align:"right",secondary:n})})]})},e.key)}function O(e){return"00/00/0000"===e.data?(0,A.jsx)(A.Fragment,{}):(0,A.jsx)(i.Z,{className:"divisor",children:(0,A.jsxs)(i.Z,{className:"data_centralizada",children:[(0,A.jsx)(i.Z,{className:"linha"}),(0,A.jsx)(i.Z,{className:"data",children:(0,A.jsx)(v.Z,{primary:e.data})}),(0,A.jsx)(i.Z,{className:"linha"})]})})}function R(e){var t=s.useState([]),a=(0,n.Z)(t,2),l=a[0],c=a[1],d=s.useState(!1),u=(0,n.Z)(d,2),m=u[0],h=u[1],f=0,g="",x=(0,s.useRef)(null);return(0,s.useEffect)((function(){h(!1);var t=o.db.doc("chats/".concat(e.id)).collection("mensagens").orderBy("timestamp","asc").onSnapshot((function(e){c([]),e.docs.map((function(e){c((function(t){return[].concat((0,F.Z)(t),[{id:e.id,idEnviou:e.data().idEnviou,texto:e.data().texto,timestamp:e.data().timestamp,lida:e.data().lida}])}))})),h(!0)}));return function(){return t()}}),[e.id]),(0,s.useEffect)((function(){x.current&&(x.current.scrollTop=x.current.scrollHeight)}),[l]),m?(0,A.jsx)(i.Z,{ref:x,className:"messageBoxContainer",children:l.map((function(t){if(t.lida||o.db.doc("chats/".concat(e.id)).collection("mensagens").doc(t.id).update({lida:!0}),1===++f||g!==(0,b.Vr)(t.timestamp)){g=(0,b.Vr)(t.timestamp);var a="";return a=(0,b.Vr)(t.timestamp)===(0,b.gi)(new Date)?"Hoje":(0,b.Vr)(t.timestamp)===(0,b.gi)(new Date((new Date).setDate((new Date).getDate()-1)))?"Ontem":(0,b.Vr)(t.timestamp),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O,{data:a}),(0,A.jsx)(q,{id:t.id,idEnviou:t.idEnviou,texto:t.texto,timestamp:t.timestamp},t.id)]})}return(0,A.jsx)(q,{id:t.id,idEnviou:t.idEnviou,texto:t.texto,timestamp:t.timestamp,onLoad:function(){return console.log("aaa")}},t.id)}))}):(0,A.jsx)(i.Z,{style:{display:"flex",justifyContent:"center"},children:(0,A.jsx)(r.Z,{style:{color:"#6DDB94"}})})}var H=function(e){return(0,A.jsx)(i.Z,{className:"background-bloqueado",children:(0,A.jsxs)(i.Z,{className:"texto-bloqueado",children:["Sua conversa com ",e.nome," est\xe1 bloqueada por motivo de den\xfancia. Por favor, caso voc\xea entenda que algo est\xe1 errado, entre em contato com o nosso suporte."]})})};function U(e){return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(P,{idUsuarioConversa:e.idUsuarioConversa,nome:e.nome,idConversa:e.id}),(0,A.jsx)(R,{id:e.id}),e.isBloqueado?(0,A.jsx)(H,{nome:e.nome}):(0,A.jsx)(_,{value:e.valueInput,onChange:e.onChange,onClick:function(){e.onClick(),""!==e.valueInput&&(0,b.sR)(e.valueInput,e.id)}})]})}var B=a(7394),W=a(890),T=a(7689);function K(){var e=(0,T.s0)();return(0,A.jsx)(A.Fragment,{children:(0,A.jsxs)(x.ZP,{className:"chat_profile",children:[(0,A.jsx)(x.ZP,{button:!0,className:"voltar",style:{display:"flex",justifyContent:"left",width:"fit-content",height:"fit-content"},onClick:function(){return e(-1)},children:(0,A.jsx)(B.Z,{style:{width:"35px",height:"35px",padding:"5px",borderRadius:"100%",background:"#363636"}})}),(0,A.jsx)(p.Z,{children:(0,A.jsx)(I.Z,{id:Number(sessionStorage.ID),nome:sessionStorage.NOME,className:"avatar"})}),(0,A.jsx)(W.Z,{variant:"h6",component:"div",children:sessionStorage.NOME})]})})}var V=a(653);function G(e){var t,a,r=s.useState(e.lida),c=(0,n.Z)(r,2),d=(c[0],c[1]),u=s.useState(10),m=(0,n.Z)(u,2),h=m[0],f=m[1],g=s.useState(!1),p=(0,n.Z)(g,2),Z=(p[0],p[1]);(0,s.useEffect)((function(){Z(!1);var t=o.db.collection("chats").doc(e.id).collection("mensagens").where("idEnviou","!=",Number(sessionStorage.getItem("ID"))).where("lida","==",!1).onSnapshot((function(e){f(e.docs.length),Z(!0)}));return function(){return t()}}),[h]);var C=new l.EK(null===(t=e.timestamp)||void 0===t?void 0:t.seconds,null===(a=e.timestamp)||void 0===a?void 0:a.nanoseconds).toDate(),S=new Date,y=C.getDate()===S.getDate()&&C.getMonth()===S.getMonth()&&C.getFullYear()===S.getFullYear(),N=(0,b.Vr)(e.timestamp),D=(0,b.ve)(e.timestamp);return(0,b.Vr)(e.timestamp)===(0,b.gi)(new Date((new Date).setDate((new Date).getDate()-1)))&&(N="Ontem"),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(x.ZP,{button:!0,onClick:function(){e.onClick(),d(!0),(0,b.dp)(e.id)},className:"chat_item",children:[(0,A.jsx)(V.Z,{children:(0,A.jsx)(I.Z,{id:e.idContato,nome:e.nome,className:"avatar"})}),(0,A.jsx)(v.Z,{primary:e.nome,secondary:(0,A.jsx)(i.Z,{className:"ultima_mensagem",children:e.ultimaMensagem}),style:{width:"40%"}}),(0,A.jsx)(v.Z,{className:"data_box",children:(0,A.jsxs)(i.Z,{className:"data_notificacao",children:[(0,A.jsx)(i.Z,{className:"tempo",children:y?D:N}),0!==h?(0,A.jsx)(i.Z,{className:"notificacao",children:(0,A.jsx)(i.Z,{className:"notificacao_numero",children:h})}):null]})})]}),(0,A.jsx)(j.Z,{variant:"fullWidth",className:"divider_chat"})]})}function z(e){var t=s.useState([]),a=(0,n.Z)(t,2),i=a[0],r=a[1],c=s.useState(!1),d=(0,n.Z)(c,2);d[0],d[1];return(0,s.useEffect)((function(){var e=(0,l.IO)((0,l.hJ)(o.db,"chats"),(0,l.or)((0,l.ar)("idProfessor","==",Number(sessionStorage.ID)),(0,l.ar)("idAluno","==",Number(sessionStorage.ID))),(0,l.Xo)("timestamp","desc"));(0,l.cf)(e,(function(e){r(""),r(e.docs.map((function(e){return{id:e.id,data:{idAluno:e.data().idAluno,idProfessor:e.data().idProfessor,nome:"Aluno"===sessionStorage.CATEGORIA?e.data().nomeProfessor:e.data().nomeAluno,ultimaMensagem:e.data().ultimaMensagem,lida:e.data().lida,timestamp:e.data().timestamp,bloqueado:e.data().bloqueado}}})))}))}),[]),(0,A.jsx)(A.Fragment,{children:i.map((function(t){return(0,A.jsx)(G,{id:t.id,nome:t.data.nome,ultimaMensagem:t.data.ultimaMensagem,timestamp:t.data.timestamp,lida:t.data.lida,foto:t.data.foto,onClick:function(){e.onChatClick(t)},idContato:"Aluno"==sessionStorage.CATEGORIA?t.data.idProfessor:t.data.idAluno},t.id)}))})}var Y=function(e){var t=(0,s.useState)(null),a=(0,n.Z)(t,2),c=a[0],d=a[1],u=(0,s.useState)([]),m=(0,n.Z)(u,2),h=(m[0],m[1]),f=(0,s.useState)(""),g=(0,n.Z)(f,2),x=g[0],p=g[1],v=(0,s.useState)(""),j=(0,n.Z)(v,2),Z=j[0],b=j[1],C=(0,s.useState)(""),S=(0,n.Z)(C,2),y=(S[0],S[1],(0,s.useState)([])),N=(0,n.Z)(y,2),D=(N[0],N[1]),w=(0,s.useState)(!1),I=(0,n.Z)(w,2),P=I[0],E=I[1],k=(0,s.useState)(!1),M=(0,n.Z)(k,2),_=M[0],F=M[1],q=(0,s.useState)(0),O=(0,n.Z)(q,2),R=O[0],H=O[1],B=(0,T.TH)(),W=B.state?B.state.idChatAtivo:null,V=B.state?B.state.chatAtivo:null;return(0,s.useEffect)((function(){var e=(0,l.IO)((0,l.hJ)(o.db,"chats"),(0,l.or)((0,l.ar)("idProfessor","==",Number(sessionStorage.idUsuario)),(0,l.ar)("idAluno","==",Number(sessionStorage.idUsuario))),(0,l.Xo)("timestamp","desc")),t=(0,l.cf)(e,(function(e){D(""),D(e.docs.map((function(e){return{id:e.id,data:{idAluno:e.data().idAluno,idProfessor:e.data().idProfessor,nome:"Aluno"===sessionStorage.CATEGORIA==="aluno"?e.data().nomeProfessor:e.data().nomeAluno,src:"Aluno"===sessionStorage.CATEGORIA==="aluno"?e.data().srcProfessor:e.data().srcAluno,ultimaMensagem:e.data().ultimaMensagem,lida:e.data().lida,timestamp:e.data().timestamp,bloqueado:e.data().bloqueado}}})))}));return F(!0),function(){return t()}}),[]),(0,s.useEffect)((function(){null!==W&&null!==V&&(d(W),"Aluno"===sessionStorage.CATEGORIA?(b(V.nomeProfessor),H(V.idProfessor)):(b(V.nomeAluno),H(V.idAluno)),h([]),E(V.bloqueado))}),[V,W]),_?(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(i.Z,{className:"chat_page",children:(0,A.jsxs)(i.Z,{className:"chat_container",children:[(0,A.jsxs)(i.Z,{className:"chat_left",children:[(0,A.jsx)(K,{}),(0,A.jsx)(i.Z,{className:"chat_list_container",children:(0,A.jsx)(z,{onChatClick:function(e){"Aluno"===sessionStorage.CATEGORIA?H(e.data.idProfessor):H(e.data.idAluno),d(e.id),b(e.data.nome),h([]),E(e.data.bloqueado)}})})]}),(0,A.jsx)(i.Z,{className:"message_container",children:c?(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(U,{id:c,nome:Z,isBloqueado:P,valueInput:x,idUsuarioConversa:R,onChange:function(e){return p(e)},onClick:function(){return p("")}})}):(0,A.jsxs)(i.Z,{className:"empty_chat",children:[(0,A.jsx)("p",{children:"Ol\xe1! Seja bem vindo ao chat"}),(0,A.jsx)("p",{children:"Clique em algum chat para come\xe7ar a conversar"})]})})]})})}):(0,A.jsx)(r.Z,{color:"success"})}},1659:function(e,t,a){a.d(t,{db:function(){return o},t:function(){return i}});var n=a(3897),s=(a(2806),a(5778),n.Z.initializeApp({apiKey:"AIzaSyBlrwBDwFdwkutdVO2Ilg6KUPnFFwKWD2k",authDomain:"chat-harmonyo.firebaseapp.com",projectId:"chat-harmonyo",storageBucket:"chat-harmonyo.appspot.com",messagingSenderId:"295019787606",appId:"1:295019787606:web:eb01ac75f11c05b72d92f7",measurementId:"G-2K9ZW7N0C1"})),o=s.firestore(),i=s.storage("gs://chat-harmonyo.appspot.com/")},7577:function(e,t,a){a.d(t,{HQ:function(){return d},Vr:function(){return o},dp:function(){return c},gi:function(){return i},sR:function(){return l},ve:function(){return r}});var n=a(1978),s=a(1659);function o(e){if(null==e)return"00/00/0000";var t=new n.EK(e.seconds,e.nanoseconds).toDate();return(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+(t.getMonth()<10?"0"+t.getMonth():t.getMonth())+"/"+t.getFullYear()}function i(e){var t=new Date(e);return(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+(t.getMonth()<10?"0"+t.getMonth():t.getMonth())+"/"+t.getFullYear()}function r(e){if(null==e)return"00/00/0000";var t=new n.EK(e.seconds,e.nanoseconds).toDate();return(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())}function l(e,t){var a=Number(sessionStorage.getItem("ID")),o=e,i=(0,n.Bt)(),r={idEnviou:a,timestamp:i,texto:e,lida:!1};s.db.doc("chats/".concat(t)).collection("mensagens").add(r).then((function(){var e=document.getElementById("scroll");e.scrollTop=e.scrollHeight})),s.db.collection("chats").doc(t).update({ultimaMensagem:o,timestamp:i})}function c(e){s.db.doc("chats/".concat(e)).collection("mensagens").where("idEnviou","!=",Number(sessionStorage.getItem("ID"))).where("lida","==",!1).get().then((function(e){e.forEach((function(e){e.ref.update({lida:!0})}))}))}function d(e){var t=e.idConversa;delete e.idConversa;var a=(0,n.Bt)();e.timestamp=a,s.db.doc("chats/".concat(t)).collection("denuncia").add(e).then((function(){s.db.doc("chats/".concat(t)).update({bloqueado:!0,timestamp:a,ultimaMensagem:"Chat bloqueado!"}).then((function(){alert("Denuncia salva!"),window.location.reload()}))})).catch((function(e){console.log(e)}))}}}]);
//# sourceMappingURL=466.6593c179.chunk.js.map